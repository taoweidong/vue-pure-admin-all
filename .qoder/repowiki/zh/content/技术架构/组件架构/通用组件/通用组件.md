# 通用组件

<cite>
**本文档引用文件**  
- [ReDialog/index.vue](file://web/src/components/ReDialog/index.vue)
- [ReDialog/type.ts](file://web/src/components/ReDialog/type.ts)
- [ReDrawer/index.vue](file://web/src/components/ReDrawer/index.vue)
- [ReDrawer/type.ts](file://web/src/components/ReDrawer/type.ts)
- [ReCountTo/src/normal/index.tsx](file://web/src/components/ReCountTo/src/normal/index.tsx)
- [ReCountTo/src/normal/props.ts](file://web/src/components/ReCountTo/src/normal/props.ts)
- [ReSeamlessScroll/src/index.vue](file://web/src/components/ReSeamlessScroll/src/index.vue)
- [ReSeamlessScroll/src/utils.ts](file://web/src/components/ReSeamlessScroll/src/utils.ts)
- [ReQrcode/src/index.tsx](file://web/src/components/ReQrcode/src/index.tsx)
- [ReQrcode/src/index.scss](file://web/src/components/ReQrcode/src/index.scss)
- [ReIcon/src/Select.vue](file://web/src/components/ReIcon/src/Select.vue)
- [ReIcon/src/hooks.ts](file://web/src/components/ReIcon/src/hooks.ts)
- [ReTreeLine/index.ts](file://web/src/components/ReTreeLine/index.ts)
- [ReTreeLine/index.scss](file://web/src/components/ReTreeLine/index.scss)
</cite>

## 目录
1. [对话框 (ReDialog)](#对话框-redialog)
2. [抽屉 (ReDrawer)](#抽屉-redrawer)
3. [数字滚动 (ReCountTo)](#数字滚动-recountto)
4. [无缝滚动 (ReSeamlessScroll)](#无缝滚动-reseamlessscroll)
5. [二维码生成 (ReQrcode)](#二维码生成-reqrcode)
6. [图标选择 (ReIcon)](#图标选择-reicon)
7. [树形线条 (ReTreeLine)](#树形线条-retreeline)

## 对话框 (ReDialog)

`ReDialog` 组件是对 Element Plus 的 `el-dialog` 进行的高级封装，提供了更灵活的配置方式和增强的交互功能。该组件通过维护一个对话框栈（`dialogStore`）来支持同时打开多个对话框，并为每个对话框提供独立的配置选项。

组件的核心特性包括：
- **全屏切换**：支持通过点击图标切换全屏状态，并提供 `fullscreenCallBack` 回调函数。
- **智能按钮**：内置“取消”和“确定”按钮，支持自定义按钮组 `footerButtons`。
- **前置钩子**：提供 `beforeCancel` 和 `beforeSure` 钩子函数，允许在关闭或确认前执行异步操作。
- **加载状态**：确定按钮支持 `sureBtnLoading` 属性，可显示加载动画。
- **气泡确认**：可通过 `popconfirm` 配置在点击确定按钮时弹出二次确认框。

该组件通过 `contentRenderer` 和 `footerRenderer` 等渲染器属性，实现了内容和页脚的完全自定义，极大地提升了组件的灵活性。

**Section sources**
- [ReDialog/index.vue](file://web/src/components/ReDialog/index.vue#L1-L207)
- [ReDialog/type.ts](file://web/src/components/ReDialog/type.ts#L1-L276)

## 抽屉 (ReDrawer)

`ReDrawer` 组件是对 Element Plus 的 `el-drawer` 的封装，其设计模式与 `ReDialog` 高度一致，旨在提供统一的弹出层交互体验。它同样维护一个抽屉栈（`drawerStore`），支持多层级抽屉的管理。

主要功能特性：
- **方向支持**：支持 `rtl`（右到左）、`ltr`（左到右）、`ttb`（上到下）、`btt`（下到上）四种展开方向。
- **内容销毁**：通过 `destroyOnClose` 属性控制关闭后是否销毁内部组件。
- **挂载点**：通过 `appendToBody` 或 `appendTo` 属性指定抽屉的挂载点。
- **增强按钮**：与 `ReDialog` 一样，提供默认的“取消”和“确定”按钮，并支持 `beforeSure`、`beforeCancel` 等前置钩子。

`ReDrawer` 的 API 设计与 `ReDialog` 保持了高度的对称性，使得开发者可以轻松地在对话框和抽屉之间进行切换，降低了学习和使用成本。

**Section sources**
- [ReDrawer/index.vue](file://web/src/components/ReDrawer/index.vue#L1-L170)
- [ReDrawer/type.ts](file://web/src/components/ReDrawer/type.ts#L1-L263)

## 数字滚动 (ReCountTo)

`ReCountTo` 组件用于实现数字的动态滚动效果，常用于数据大屏、统计面板等场景。它基于 `requestAnimationFrame` 实现平滑的动画效果，确保性能和流畅度。

核心实现原理：
- **动画驱动**：使用 `requestAnimationFrame` 进行逐帧渲染，计算当前时间戳与开始时间的差值，从而确定数字的当前值。
- **缓动函数**：通过 `easingFn` 属性支持自定义缓动函数，实现不同的滚动加速度效果。默认使用指数缓动函数。
- **格式化输出**：`formatNumber` 方法支持对数字进行格式化，包括小数位数、千分位分隔符、前缀、后缀等。

组件提供了 `start`、`pause`、`resume`、`reset` 等方法，允许开发者精确控制滚动动画的生命周期。`autoplay` 属性控制是否在组件挂载后自动开始动画。

**Section sources**
- [ReCountTo/src/normal/index.tsx](file://web/src/components/ReCountTo/src/normal/index.tsx#L1-L180)
- [ReCountTo/src/normal/props.ts](file://web/src/components/ReCountTo/src/normal/props.ts#L1-L33)

## 无缝滚动 (ReSeamlessScroll)

`ReSeamlessScroll` 组件用于实现内容的无缝循环滚动，支持上下左右四个方向。其核心是通过 CSS `transform` 属性和 `requestAnimationFrame` 实现高性能的动画。

实现机制：
- **双倍内容**：组件内部会复制一份原始内容，当第一份内容完全移出视口时，立即将位置重置，从而实现视觉上的无缝衔接。
- **动画循环**：通过 `scrollMove` 函数递归调用 `requestAnimationFrame` 来持续更新 `xPos` 或 `yPos` 的值，驱动内容移动。
- **单步滚动**：当配置了 `singleHeight` 或 `singleWidth` 时，组件会计算每次移动的距离，并在移动到特定位置时暂停 `waitTime` 毫秒，实现“走一步停一下”的效果。
- **触摸支持**：通过 `touchStart`、`touchMove`、`touchEnd` 事件处理移动端的触摸滑动操作。

组件还支持鼠标悬停暂停、手动控制左右切换、鼠标滚轮控制等交互方式，功能非常全面。

**Section sources**
- [ReSeamlessScroll/src/index.vue](file://web/src/components/ReSeamlessScroll/src/index.vue#L1-L539)
- [ReSeamlessScroll/src/utils.ts](file://web/src/components/ReSeamlessScroll/src/utils.ts#L1-L120)

## 二维码生成 (ReQrcode)

`ReQrcode` 组件基于 `qrcode` 库封装，用于生成二维码。它支持 `canvas` 和 `img` 两种渲染模式，并支持在二维码中心嵌入 Logo。

核心功能：
- **Logo 嵌套**：通过 `logo` 属性传入 Logo 图片的 URL 或配置对象，组件会将 Logo 绘制在 `canvas` 上，然后生成最终的二维码图片。
- **容错率自适应**：根据二维码内容的长度自动调整容错率（`errorCorrectionLevel`），内容越短容错率越高，以保证二维码的可读性。
- **过期状态**：通过 `disabled` 属性可以将二维码置为“过期”状态，此时会显示一个刷新图标和提示文字，提示用户刷新。
- **加载状态**：在二维码生成过程中显示加载动画。

组件通过 `toCanvas` 和 `toDataURL` 方法将文本内容转换为二维码图像，并通过 `createLogoCode` 函数处理 Logo 的绘制和圆角效果。

**Section sources**
- [ReQrcode/src/index.tsx](file://web/src/components/ReQrcode/src/index.tsx#L1-L262)
- [ReQrcode/src/index.scss](file://web/src/components/ReQrcode/src/index.scss#L1-L10)

## 图标选择 (ReIcon)

`ReIcon` 组件提供了一个图标选择器，集成了 Element Plus、Remix Icon 和 Font Awesome 5 Solid 三大图标的在线和离线版本。

主要特性：
- **多源集成**：通过 `IconJson` 数据文件和 `useRenderIcon` 工具函数，统一管理不同来源的图标。
- **搜索功能**：在弹出的 `el-popover` 中提供搜索框，可以实时过滤图标列表。
- **分页展示**：图标列表按页展示，每页显示 35 个图标，避免一次性加载过多 DOM 节点。
- **动态激活**：当输入框中已存在图标时，选择器会自动定位到该图标所在的标签页和页码。

`Select.vue` 是图标选择器的核心组件，它使用 `el-input` 的 `append` 插槽来显示一个可点击的图标预览。点击后弹出 `el-popover`，其中包含 `el-tabs` 用于切换图标库，`el-scrollbar` 用于滚动查看图标，以及 `el-pagination` 用于分页。

**Section sources**
- [ReIcon/src/Select.vue](file://web/src/components/ReIcon/src/Select.vue#L1-L269)
- [ReIcon/src/hooks.ts](file://web/src/components/ReIcon/src/hooks.ts#L1-L64)

## 树形线条 (ReTreeLine)

`ReTreeLine` 组件用于为 `el-tree` 或 `el-tree-v2` 组件添加树形连接线，以更清晰地展示节点间的层级关系。

实现原理：
- **层级遍历**：通过 `lastnodeArr` 数组记录从当前节点到根节点的路径上，每一层的节点是否是该层的最后一个节点。
- **垂直线绘制**：根据节点的层级 `level`，循环生成多个 `span` 元素作为垂直连接线。通过 `last-node-line` 和 `last-node-isLeaf-line` CSS 类来控制最后一个节点的线条显示。
- **水平线绘制**：在每个节点的左侧绘制一个短的水平连接线。
- **标签包装**：将节点的标签内容包装在一个 `element-tree-node-label-wrapper` 容器中，以便与连接线对齐。

该组件通过 `render` 函数直接返回 VNode，实现了高效的渲染。其样式通过 SCSS 变量定义，便于主题定制。

**Section sources**
- [ReTreeLine/index.ts](file://web/src/components/ReTreeLine/index.ts#L1-L156)
- [ReTreeLine/index.scss](file://web/src/components/ReTreeLine/index.scss#L1-L56)
# 路由配置

<cite>
**本文档引用文件**  
- [index.ts](file://web/src/router/index.ts)
- [utils.ts](file://web/src/router/utils.ts)
- [able.ts](file://web/src/router/modules/able.ts)
- [about.ts](file://web/src/router/modules/about.ts)
- [board.ts](file://web/src/router/modules/board.ts)
- [remaining.ts](file://web/src/router/modules/remaining.ts)
- [enums.ts](file://web/src/router/enums.ts)
- [types.ts](file://web/src/layout/types.ts)
</cite>

## 目录
1. [简介](#简介)
2. [静态路由定义与模块化组织](#静态路由定义与模块化组织)
3. [动态导入路由模块](#动态导入路由模块)
4. [路由配置字段详解](#路由配置字段详解)
5. [路由模块划分策略](#路由模块划分策略)
6. [路由配置最佳实践](#路由配置最佳实践)
7. [路由与菜单生成关系](#路由与菜单生成关系)
8. [总结](#总结)

## 简介
`vue-pure-admin-all` 是一个基于 Vue 3 和 Vue Router 的现代化管理后台框架，其路由系统设计清晰、结构合理，支持静态路由与动态路由的混合使用。本文档旨在详细说明该项目的路由配置机制，涵盖从模块组织、动态导入、字段含义到最佳实践的完整内容，帮助开发者深入理解并高效使用其路由系统。

## 静态路由定义与模块化组织

项目中的静态路由采用模块化方式组织，所有功能模块的路由配置均存放在 `src/router/modules/` 目录下，每个模块对应一个独立的 `.ts` 文件，如 `able.ts`、`about.ts`、`board.ts` 等。这种设计实现了路由按功能解耦，便于维护和扩展。

每个模块文件导出一个符合 `RouteRecordRaw` 类型的路由对象，通常包含 `path`、`redirect`、`meta` 和 `children` 字段。其中 `children` 数组定义了该模块下的具体页面路由。例如，`about.ts` 模块仅包含一个关于页面的子路由。

**Section sources**
- [about.ts](file://web/src/router/modules/about.ts#L1-L23)
- [able.ts](file://web/src/router/modules/able.ts#L1-L215)

## 动态导入路由模块

项目通过 Vite 的 `import.meta.glob` API 实现了路由模块的自动导入，避免了手动逐个引入的繁琐操作。在 `src/router/index.ts` 中，使用以下代码匹配并导入所有模块路由：

```ts
const modules: Record<string, any> = import.meta.glob(
  ["./modules/**/*.ts", "!./modules/**/remaining.ts"],
  { eager: true }
);
```

此语句会**同步导入** `modules` 目录下所有 `.ts` 文件（排除 `remaining.ts`），并将它们收集到 `modules` 对象中。随后通过遍历该对象，将每个模块的默认导出（即路由配置）推入 `routes` 数组。这种方式极大地提升了路由配置的自动化程度和可维护性。

**Section sources**
- [index.ts](file://web/src/router/index.ts#L15-L25)

## 路由配置字段详解

路由对象的各个字段具有明确的语义和作用，主要字段如下：

- **`path`**: 路由的访问路径，如 `/about/index`。
- **`name`**: 路由的唯一名称，用于编程式导航和缓存控制。
- **`component`**: 路由对应的视图组件，采用动态导入（`() => import(...)`）实现懒加载。
- **`meta`**: 路由的元信息对象，包含多个控制字段：
  - `title`: 页面标题，用于菜单显示和浏览器标签页。
  - `icon`: 菜单图标，支持字符串或组件。
  - `rank`: 菜单排序等级，数值越小越靠前，定义在 `enums.ts` 中。
  - `showLink`: 是否在菜单中显示该路由，默认为 `true`。
  - `keepAlive`: 是否缓存该页面组件，`true` 时启用 `keep-alive`。
  - `frameSrc`: 当值存在时，表示该路由为内嵌 iframe 页面，组件会被替换为 `IFrame` 布局。
  - `auths`: 定义该路由所需的按钮级权限码。
  - `transition`: 定义页面切换时的动画效果。

例如，在 `board.ts` 中，`frameSrc` 字段被用来加载外部画板应用。

**Section sources**
- [board.ts](file://web/src/router/modules/board.ts#L1-L26)
- [able.ts](file://web/src/router/modules/able.ts#L1-L215)
- [types.ts](file://web/src/layout/types.ts#L4-L26)

## 路由模块划分策略

项目根据功能将路由划分为多个独立模块，每个模块负责一个特定的功能域：

- **`able` 模块**: 集成各类实用工具和第三方组件，如 MQTT 客户端、条形码、PDF 预览等。
- **`about` 模块**: 关于页面，展示项目信息。
- **`board` 模块**: 内嵌外部应用（如在线画板），通过 `frameSrc` 实现。
- **`remaining` 模块**: 存放不参与常规菜单的特殊路由，如登录页、403/500 错误页、重定向页等。

这种划分策略使得代码结构清晰，职责分明。模块的排序由 `meta.rank` 字段控制，该值引用自 `src/router/enums.ts` 中定义的常量，确保了菜单顺序的可维护性。

**Section sources**
- [enums.ts](file://web/src/router/enums.ts#L1-L62)
- [remaining.ts](file://web/src/router/modules/remaining.ts#L1-L69)

## 路由配置最佳实践

项目在路由配置上遵循了多项最佳实践：

- **命名规范**: 路由 `name` 采用 PascalCase 风格（如 `About`、`Print`），与组件名保持一致，便于识别。
- **懒加载策略**: 所有组件均使用动态导入语法，实现代码分割和按需加载，优化首屏性能。
- **代码分割**: 通过模块化设计和 `import.meta.glob`，天然实现了路由级别的代码分割。
- **自动化处理**: 利用 `formatTwoStageRoutes` 和 `formatFlatteningRoutes` 等工具函数，将多级嵌套路由拍平为二级结构，以兼容 `keep-alive` 的缓存机制（`keep-alive` 仅支持缓存一级或二级路由）。
- **国际化支持**: 路由标题通过 `$t()` 函数进行国际化处理，确保多语言支持。

**Section sources**
- [index.ts](file://web/src/router/index.ts#L30-L40)
- [utils.ts](file://web/src/router/utils.ts#L200-L240)

## 路由与菜单生成关系

路由配置与菜单生成紧密耦合。项目通过 `constantMenus` 变量导出保持原始层级的路由树，用于渲染侧边栏菜单。`meta` 字段中的 `showLink` 用于控制菜单项的显示与隐藏，`rank` 控制菜单排序。

权限控制通过 `meta.roles` 字段实现。在路由守卫中，会检查当前用户的角色（`userInfo.roles`）是否与路由要求的角色匹配，若不匹配则跳转至 403 页面。此外，`getAuths()` 和 `hasAuth()` 工具函数用于判断按钮级别的权限，实现细粒度的 UI 控制。

**Section sources**
- [index.ts](file://web/src/router/index.ts#L150-L180)
- [utils.ts](file://web/src/router/utils.ts#L300-L330)

## 总结

`vue-pure-admin-all` 的路由系统设计精良，通过模块化组织、`import.meta.glob` 动态导入、规范化的字段定义和完善的工具函数，构建了一个高效、可维护的前端路由架构。开发者只需遵循既定的模式添加新的路由模块，即可自动集成到整个系统中，极大地提升了开发效率和代码质量。
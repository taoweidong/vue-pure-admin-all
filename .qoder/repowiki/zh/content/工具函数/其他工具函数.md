# 其他工具函数

<cite>
**本文档中引用的文件**  
- [chinaArea.ts](file://web/src/utils/chinaArea.ts)
- [globalPolyfills.ts](file://web/src/utils/globalPolyfills.ts)
- [preventDefault.ts](file://web/src/utils/preventDefault.ts)
- [print.ts](file://web/src/utils/print.ts)
- [propTypes.ts](file://web/src/utils/propTypes.ts)
- [responsive.ts](file://web/src/utils/responsive.ts)
- [sso.ts](file://web/src/utils/sso.ts)
</cite>

## 目录
1. [简介](#简介)
2. [中国行政区划数据查询（chinaArea.ts）](#中国行政区划数据查询chinaareats)
3. [JavaScript全局方法补丁（globalPolyfills.ts）](#javascript全局方法补丁globalpolyfillsts)
4. [事件默认行为阻止（preventDefault.ts）](#事件默认行为阻止preventdefaultts)
5. [页面打印功能支持（print.ts）](#页面打印功能支持printts)
6. [Vue组件Props类型校验工具（propTypes.ts）](#vue组件props类型校验工具proptypsts)
7. [响应式断点检测（responsive.ts）](#响应式断点检测responsivets)
8. [单点登录逻辑处理（sso.ts）](#单点登录逻辑处理ssots)
9. [总结](#总结)

## 简介
本项目包含多个辅助性工具函数模块，分别用于处理中国行政区划数据、兼容性补丁、事件行为控制、打印功能、类型校验、响应式布局及单点登录等常见前端需求。这些模块在项目架构中作为基础支撑组件，提升开发效率与用户体验。

## 中国行政区划数据查询（chinaArea.ts）

该模块提供中国省、市、区三级联动数据结构及汉字与区域码互转功能，适用于地址选择器、表单填写等场景。

主要导出内容包括：
- `provinceAndCityData`：省市级联动数据（不含“全部”选项）
- `regionData`：省市区三级联动数据
- `provinceAndCityDataPlus` 和 `regionDataPlus`：包含“全部”选项的扩展数据
- `CodeToText` 和 `TextToCode`：区域码与文本互转映射对象
- `convertTextToCode`：根据省、市、区名称获取对应区域码的方法

此模块通过 `china-area-data` 第三方库加载基础数据，并构建树形结构供前端组件使用，常用于 `el-cascader` 等级联选择器。

**Section sources**
- [chinaArea.ts](file://web/src/utils/chinaArea.ts#L1-L190)

## JavaScript全局方法补丁（globalPolyfills.ts）

为解决某些第三方库（如 aws-sdk-js）依赖 `global` 对象而导致的运行时错误，该模块在浏览器环境中模拟 Node.js 的 `global` 全局变量。

当检测到 `window.global` 未定义时，自动将其指向 `window` 对象，从而避免 `global is not defined` 错误。

使用方式：在 `src/main.ts` 中引入该文件即可生效。

**Section sources**
- [globalPolyfills.ts](file://web/src/utils/globalPolyfills.ts#L1-L8)

## 事件默认行为阻止（preventDefault.ts）

封装了多个常见浏览器默认行为的阻止逻辑，提升应用安全性和用户体验。

通过 `useEventListener`（来自 `@vueuse/core`）注册全局事件监听器，实现以下功能：
- 禁用 F12 快捷键打开开发者工具
- 禁止右键弹出默认上下文菜单（不影响自定义右键菜单）
- 阻止页面元素被选中
- 禁止图片拖拽操作

使用方式：在 `src/main.ts` 中调用 `addPreventDefault()` 方法即可启用所有防护机制。

**Section sources**
- [preventDefault.ts](file://web/src/utils/preventDefault.ts#L1-L28)

## 页面打印功能支持（print.ts）

提供完整的页面打印解决方案，支持自定义样式、动态高度设置及打印前后回调。

核心类 `Print` 接收目标 DOM 元素或选择器，并可传入选项配置：
- `styleStr`：额外注入的打印样式
- `setDomHeightArr`：需动态设置高度的元素选择器数组
- `printBeforeFn`：打印前回调（可用于数据准备）
- `printDoneCallBack`：打印完成后回调

内部通过创建隐藏 iframe 加载页面内容并执行打印，确保样式完整继承且不影响主页面交互。

**Section sources**
- [print.ts](file://web/src/utils/print.ts#L1-L223)

## Vue组件Props类型校验工具（propTypes.ts）

基于 `vue-types` 库封装的类型校验工具类，简化 Vue 组件中 `props` 的定义过程。

扩展默认类型系统，提供两个专用校验器：
- `style`：支持字符串或对象类型的样式属性校验
- `VNodeChild`：用于校验可渲染内容（VNode、JSX、字符串等）

采用 ES6+ 类静态属性方式实现，符合现代 TypeScript 语法规范，避免使用已废弃的 `extend()` 方法。

**Section sources**
- [propTypes.ts](file://web/src/utils/propTypes.ts#L1-L39)

## 响应式断点检测（responsive.ts）

集成 `responsive-storage` 第三方库，实现响应式状态管理与持久化存储。

`injectResponsiveStorage` 函数用于在应用启动时注入响应式存储实例，支持以下配置项的持久化：
- 国际化语言设置（locale）
- 布局模式与主题颜色（layout）
- 界面显示配置（configure）
- 多标签页缓存状态（tags）

所有配置均按命名空间隔离存储，避免不同项目间冲突，并支持从平台配置 `PlatformConfigs` 中读取默认值，实现灵活的环境适配。

**Section sources**
- [responsive.ts](file://web/src/utils/responsive.ts#L1-L46)

## 单点登录逻辑处理（sso.ts）

实现前端简版单点登录（SSO）自动处理逻辑，适用于多系统集成场景。

工作流程如下：
1. 解析 URL 参数，判断是否包含 `username`、`roles`、`accessToken` 三项关键信息
2. 若完整匹配，则判定为 SSO 登录请求
3. 清除本地旧认证信息
4. 将新 token 和用户信息写入本地存储
5. 清理 URL 中敏感参数，防止泄露
6. 使用 `location.replace` 跳转至目标页面，避免历史记录污染

该机制无需后端介入即可完成跨系统登录跳转，适用于演示环境或轻量级集成方案。

**Section sources**
- [sso.ts](file://web/src/utils/sso.ts#L1-L59)

## 总结
上述工具函数模块各司其职，共同构建了项目的基础能力支撑体系。从数据查询、兼容性处理到用户交互控制，均体现了模块化设计思想。合理使用这些工具可显著提升开发效率与系统稳定性。